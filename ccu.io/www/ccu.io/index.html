<title>CCU.IO</title>
<script src="/lib/js/jquery-1.10.2.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    var regaObjects = null;
    function getObjDesc (id) {
        if (regaObjects != null && regaObjects[id] !== undefined) {
            var parent = "";
            var p = regaObjects[id]["Parent"];
            if (p !== undefined && regaObjects[p]["DPs"] !== undefined)
                parent = regaObjects[p]["Name"] + "/";
            else if (regaObjects[id]["TypeName"] !== undefined) {
                if (regaObjects[id]["TypeName"] == "VARDP") {  
                    "Variable" + " / ";
                }
                else
                if (regaObjects[id]["TypeName"] == "PROGRAM") {  
                    "Program" + " / ";
                }
            }
        
            if (regaObjects[id]["Address"] !== undefined)
                return parent + regaObjects[id]["Name"] + "/" + regaObjects[id]["Address"];
            else
                return parent + regaObjects[id]["Name"];
        }
        else
            return "";
    }
    $(document).ready(function () {
        var output = $("#output");
        var socket = io.connect( $(location).attr('protocol') + '//' +  $(location).attr('host'));
        socket.on('event', function(obj) {
            $("#output").prepend(JSON.stringify(obj)+"\n");
            $("#output").prepend(getObjDesc(obj[0]));       
        });

        $("#dataRefresh").click(function() {
            $("#data").html("");
            socket.emit('getDatapoints', function(obj) {
                $("#data").html(JSON.stringify(obj, null, "  "));
            });

        });

        $("#metaRefresh").click(function() {
            $("#meta").html("");
            socket.emit('getObjects', function(obj) {
                $("#meta").html(JSON.stringify(obj, null, "  "));
                regaObjects = obj;
            });
        });

        $("#indexRefresh").click(function() {
            $("#index").html("");
            socket.emit('getIndex', function(obj) {
                $("#index").html(JSON.stringify(obj, null, "  "));
            });
        });

        $("#stringtableRefresh").click(function() {
            $("#stringtable").html("");
            socket.emit('getStringtable', function(obj) {
                $("#stringtable").html(JSON.stringify(obj, null, "  "));
            });
        });


        $("#clearOutput").click(function() {
            $("#output").html("");
        });

    });
</script>
<style type="text/css">
    .box {
        float: left;

    }
    textarea {
        width: 400px;
        height: 320px;
        margin: 5px;
    }
</style>
<body>
<h3>CCU.IO</h3>
    <div class="box">
        regaObject, getObjects()<br><br>
        <input id="metaRefresh" type="button" value="refresh"/><br/>
        <textarea id="meta"></textarea>
    </div>

    <div class="box">
        datapoints, getDatapoints()<br/>ID Arrays: value, timestamp, ack, LastChange<br>
        <input id="dataRefresh" type="button" value="refresh"/><br/>
        <textarea id="data"></textarea>
    </div>

<div class="box">
    regaIndex, getIndex()<br/>Name Arrays: id, TypeName [,Parent]<br>
    <input id="indexRefresh" type="button" value="refresh"/><br/>
    <textarea id="index"></textarea>
</div>

<div class="box">
    stringtable, getStringtable()<br/><br/>
    <input id="stringtableRefresh" type="button" value="refresh"/><br/>
    <textarea id="stringtable"></textarea>
</div>

<div class="box">
        Events&nbsp;<input value="Clear" type="button" id="clearOutput"><br/>
        <textarea style="width:1220px" id="output"></textarea>
    </div>

</body>
